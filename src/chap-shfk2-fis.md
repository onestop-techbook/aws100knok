---
class: chapter
---

# 私たちはどう信頼性を高めるか　〜FISのススメ〜

<div class="flush-right">
深津新太郎 @shin_fukatsu
</div>

## はじめに

みなさんは、システムの信頼性を高めるためにどういった取り組みをされていますか。私は普段、生活インフラ系のオンプレミスシステムの開発・運用において、プロジェクトマネージャーとして業務に携わっており、日々、「信頼性をどのように確認するか、安定稼働を実現するか」について考えています。

開発したシステムの信頼性を確認するため、開発フェーズでは擬似障害を発生させ、試験を実施しています。具体的には、サーバを意図的にシャットダウンしたり、LANケーブルやSANのFCを抜いたり、物理的なハード障害だけでなく、プロセスダウンなど論理障害も発生させて、フェイルオーバや経路切り替えが正しく機能するかを検証してきました。

今後、クラウドへ移行した後も、当然ながらシステムの安定稼働とサービスの継続提供が求められます。AWS上でも、ネットワークやマネージドサービスで障害を発生させて動作を確認する手段を用意して、それらが想定通りに動作するかを確認することが重要です。

我々はどうやってシステムの信頼性を高めていくべきなのか。そんなみなさんに私がおすすめしたいのが、AWS Fault Injection Service（FIS）の活用です。

## 簡単に障害を注入できる

FIS推しポイントの1点目は、実際に稼働しているAWSリソースに対して、意図したタイミングで障害を注入できる点です。EC2のシャットダウン、EBSボリュームの切断、RDSの再起動、ECSの強制停止、Lambdaの遅延など、様々な障害を簡単に起こせます。どういった障害が起きた時に、どのように対処し、ユーザー影響をどれだけ抑えつつ回復できるのかを、「実機」で確認できるのが強みだと思います。

## 他AWSサービスと連携した自動化が可能

FIS推しポイントの2点目は、CloudWatch、Amazon EventBridge、AWS Systems Manager、AWS Configなどのサービスと連携できる点です。障害発生時の監視・通知・復旧までの自動化方法を考えて、検証することができます。

例えば障害を契機に、以下のような動作が自動実行されることができます。

* FISでEC2インスタンスの強制再起動を実行
* EventBridgeが異常を検知してLambda関数を実行し、自動復旧スクリプトを起動
* CloudWatchで出力されたアラームを契機に障害の開始、終了を制御

単純に障害に対する復旧動作が正常に動くかの確認だけでなく、一連の動作が確認できることが良いです。

## 障害シナリオで段階的な障害注入が可能

FIS推しポイントの3点目は、複数の障害をステップとして定義し、段階的に実行することができる点です。いろいろな障害を順番に発生させることで複合的な障害シナリオの検証が可能になります。

たとえば以下のようなシナリオを構成できます。

* ステップ1：FISでLambdaの遅延→タイムアウトを30%の割合で発生させ、リトライが発生しフロント処理の輻輳を発生させる
* ステップ2：FISでLambdaの遅延→タイムアウトを100%の割合で発生させ、フロント処理がストップする
* ステップ3：FISでLambdaの遅延を発生させないようにして、フロントからのアクセスが急増した際にバックエンドやRDSの処理がさばき切れるかを確認

こうしたシナリオ試験は、実際の運用で発生しやすい障害を再現できるため、単純な障害時の信頼性の動作確認だけでなく、復旧時にシステムが正常かどうできるかを確認する上でとても有効な策だと考えています。

###  再現性を活用したGameDayの実践

FIS推しポイントの4点目は、単なる1つのサービスではない点です。開発フェーズではシステムの中身を分かったエンジニアが試験をしていると思います。一方で運用フェーズに入るとそのメンバーがいないケースも少なくないと思います。そのため、障害対応のノウハウ継承がうまくできないこともあるかと思います。そういった場合でもFISが有効に活用できます。

シナリオは何度でも繰り返し実行できますので、前述のシナリオをしっかりと準備しておくことで、システムの詳細に詳しくないエンジニアに対しても複雑な障害訓練を提供できます。運用フェーズでの障害訓練が机上になってしまっていたりはしないでしょうか。開発フェーズの内にFISのシナリオを複数準備しておけば、運用フェーズでメンバーが障害の内容を把握しない状態で、シナリオをランダムに選択して実行すれば、本番さながらの障害訓練が実施できると考えています。

AWS Well-Architected Frameworkにおいても、「REL12-BP05 定期的にゲームデーを実施する」というベストプラクティスががあります。ベストプラクティスで推奨されている定期的な障害訓練に有効なサービス、それがFISです。

## まとめ：FISはエンジニア育成サービス

FISは、単に信頼性を高めるだけでなく、エンジニアの育成サービスとしての側面も持っていると私は考えています。FISを活用することで、単に障害試験でシステムの信頼性を担保するだけでなく、障害訓練を通してシステムをどう回復させるのかをエンジニア自身が理解してスキルアップに繋げることができるのではないでしょうか。

いろいろ偉そうなことを書いてきた私も現在、FISを勉強中です。みんなで勉強して、効率的に信頼性の高いシステムの稼働、自信を持って障害対応をこなせるエンジニアを目指していきましょう！


#### 著者紹介

---

<div class="author-profile">
    <img src="images/shfk2.jpg">
    <div>
        <div>
            <b>深津　新太郎</b>
            <a href="https://twitter.com/shin_fukatsu">X@shin_fukatsu</a>
        </div>
        <div>
            サークル名：JAWS-UG 彩の国埼玉支部
        </div>
    </div>
</div>
<p style="margin-top: 0.5em; margin-bottom: 2em;">
AWS Community Builders 2025 (Cloud Operations) / AWS Certifications  x 15 / 現在はオンプレシステム更改のPMを担当 / re:Invent 2022-2024参戦<br>
</p>